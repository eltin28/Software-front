<div class="stock-detallado-container">
  <h2>Detalle de Stock por Lote</h2>

  <div class="busqueda">
    <label for="producto">Seleccione un producto:</label>
    <select id="producto" [(ngModel)]="productoSeleccionado" (change)="buscarStock()">
      <option value="" disabled selected>-- Seleccione --</option>
      @for (p of resumenProductos(); track p.idProducto) {
        <option [value]="p.idProducto">{{ p.nombreProducto }}</option>
      }
    </select>
  </div>

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (cargando()) {
    <div class="cargando">Cargando...</div>
  }

  @if (!cargando() && stockPorLote().length > 0) {
    <table class="tabla-stock">
      <thead>
        <tr>
          <th>CÃ³digo de Lote</th>
          <th>Cantidad Disponible</th>
          <th>Fecha de Vencimiento</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        @for (lote of stockPorLote(); track lote.codigoLote) {
          <tr>
            <td>{{ lote.codigoLote }}</td>
            <td>{{ lote.cantidad }}</td>
            <td [class.vencido]="estaVencido(lote.fechaVencimiento)">
              {{ lote.fechaVencimiento | date: 'yyyy-MM-dd' }}
            </td>
            <td>{{ lote.estado }}</td>
          </tr>
        }
      </tbody>
    </table>
  } @else if (!cargando() && stockPorLote().length === 0 && productoSeleccionado() && !error()) {
    <p>No hay lotes registrados para este producto.</p>
  }
</div>
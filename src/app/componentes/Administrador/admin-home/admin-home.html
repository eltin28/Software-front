<div class="home-container" role="main" aria-labelledby="panel-title">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="title-section">
        <h1 id="panel-title" class="titulo">Panel del Administrador</h1>
        <p class="subtitulo">Resumen general del sistema</p>
      </div>
      <button 
        class="btn-recargar" 
        (click)="recargarDatos()" 
        [disabled]="cargando()"
        [attr.aria-busy]="cargando()"
        aria-label="Actualizar datos del dashboard">
        <i class="fa-solid fa-rotate-right" [class.spinning]="cargando()" aria-hidden="true"></i>
        <span>Actualizar</span>
      </button>
    </div>
  </header>

  <!-- Alerta de Error -->
  @if (error()) {
    <div class="alert-error" role="alert" aria-live="assertive">
      <i class="fa-solid fa-circle-exclamation" aria-hidden="true"></i>
      <div class="alert-content">
        <strong>Error al cargar datos</strong>
        <span>{{ error() }}</span>
      </div>
      <button class="btn-retry" (click)="recargarDatos()" aria-label="Reintentar carga de datos">
        <i class="fa-solid fa-rotate-right"></i>
        Reintentar
      </button>
    </div>
  }

  <!-- Loading State -->
  @if (cargando()) {
    <div class="loading-container" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <p>Cargando datos generales...</p>
    </div>
  } @else {
    <div class="dashboard-content">
      
      <!-- ========== SECCIÓN: PRODUCCIÓN ========== -->
      <section class="dashboard-section" aria-label="Indicadores de producción">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fa-solid fa-industry" aria-hidden="true"></i>
            Producción
          </h2>
        </div>
        <div class="cards-grid grid-3">
          
          <!-- Lotes Totales -->
          <article class="metric-card card-primary" aria-labelledby="lotes-totales">
            <div class="card-header">
              <div class="icon-wrapper icon-primary">
                <i class="fa-solid fa-industry"></i>
              </div>
              <span class="card-label">Lotes totales</span>
            </div>
            <div class="card-body">
              <h3 id="lotes-totales" class="metric-value">{{ totalLotes() }}</h3>
              <p class="metric-description">Total de lotes en el sistema</p>
            </div>
          </article>

          <!-- En Producción -->
          <article class="metric-card card-info" aria-labelledby="lotes-produccion">
            <div class="card-header">
              <div class="icon-wrapper icon-info">
                <i class="fa-solid fa-gears"></i>
              </div>
              <span class="card-label">En producción</span>
            </div>
            <div class="card-body">
              <h3 id="lotes-produccion" class="metric-value">{{ lotesEnProduccionCount() }}</h3>
              <p class="metric-description">Lotes activos en producción</p>
            </div>
          </article>

          <!-- Próximos a Vencer -->
          <article 
            class="metric-card" 
            [class.card-warning]="lotesPorVencerCount() > 0"
            [class.card-success]="lotesPorVencerCount() === 0"
            [attr.aria-label]="lotesPorVencerCount() > 0 ? 'Alerta: ' + lotesPorVencerCount() + ' lotes próximos a vencer' : 'Sin lotes próximos a vencer'">
            <div class="card-header">
              <div class="icon-wrapper" 
                   [class.icon-warning]="lotesPorVencerCount() > 0" 
                   [class.icon-success]="lotesPorVencerCount() === 0">
                <i class="fa-solid fa-calendar-day"></i>
              </div>
              <span class="card-label">Próximos a vencer</span>
              @if (lotesPorVencerCount() > 0) {
                <span class="badge badge-warning">
                  <i class="fa-solid fa-exclamation-triangle"></i>
                </span>
              }
            </div>
            <div class="card-body">
              <h3 class="metric-value">{{ lotesPorVencerCount() }}</h3>
              <p class="metric-description">
                @if (lotesPorVencerCount() > 0) {
                  <span class="text-warning">Requieren atención</span>
                } @else {
                  <span>Todo está al día</span>
                }
              </p>
            </div>
          </article>
          
        </div>
      </section>

      <!-- ========== SECCIÓN: ALMACÉN E INVENTARIO ========== -->
      <section class="dashboard-section" aria-label="Indicadores de almacén">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fa-solid fa-warehouse" aria-hidden="true"></i>
            Almacén e Inventario
          </h2>
        </div>
        <div class="cards-grid grid-4">
          
          <!-- Productos en Inventario -->
          <article class="metric-card card-accent" aria-labelledby="productos-inventario">
            <div class="card-header">
              <div class="icon-wrapper icon-accent">
                <i class="fa-solid fa-box"></i>
              </div>
              <span class="card-label">Productos</span>
            </div>
            <div class="card-body">
              <h3 id="productos-inventario" class="metric-value">{{ productosInventario() }}</h3>
              <p class="metric-description">SKUs en inventario</p>
            </div>
          </article>

          <!-- Stock Total -->
          <article class="metric-card card-success" aria-labelledby="stock-total">
            <div class="card-header">
              <div class="icon-wrapper icon-success">
                <i class="fa-solid fa-cubes"></i>
              </div>
              <span class="card-label">Stock total</span>
            </div>
            <div class="card-body">
              <h3 id="stock-total" class="metric-value">{{ stockTotal() }}</h3>
              <p class="metric-description">Unidades disponibles</p>
            </div>
          </article>

          <!-- Lotes Registrados -->
          <article class="metric-card card-secondary" aria-labelledby="lotes-registrados">
            <div class="card-header">
              <div class="icon-wrapper icon-secondary">
                <i class="fa-solid fa-layer-group"></i>
              </div>
              <span class="card-label">Lotes</span>
            </div>
            <div class="card-body">
              <h3 id="lotes-registrados" class="metric-value">{{ lotesRegistrados() }}</h3>
              <p class="metric-description">Total en almacén</p>
            </div>
          </article>

          <!-- Vencen en 7 Días -->
          <article 
            class="metric-card" 
            [class.card-danger]="vencenEn7Dias() > 0"
            [class.card-success]="vencenEn7Dias() === 0"
            [attr.aria-label]="vencenEn7Dias() > 0 ? 'Alerta crítica: ' + vencenEn7Dias() + ' productos vencen en 7 días' : 'Sin productos próximos a vencer'">
            <div class="card-header">
              <div class="icon-wrapper" 
                   [class.icon-danger]="vencenEn7Dias() > 0" 
                   [class.icon-success]="vencenEn7Dias() === 0">
                <i class="fa-solid fa-clock"></i>
              </div>
              <span class="card-label">Vencimiento</span>
              @if (vencenEn7Dias() > 0) {
                <span class="badge badge-danger pulse">
                  <i class="fa-solid fa-exclamation"></i>
                </span>
              }
            </div>
            <div class="card-body">
              <h3 class="metric-value">{{ vencenEn7Dias() }}</h3>
              <p class="metric-description">
                @if (vencenEn7Dias() > 0) {
                  <span class="text-danger">Vencen en 7 días</span>
                } @else {
                  <span>Sin vencimientos próximos</span>
                }
              </p>
            </div>
          </article>
          
        </div>
      </section>

      <!-- ========== SECCIÓN: CATÁLOGO ========== -->
      <section class="dashboard-section" aria-label="Indicadores de catálogo">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fa-solid fa-book" aria-hidden="true"></i>
            Catálogo de Productos
          </h2>
        </div>
        <div class="cards-grid grid-1">
          
          <!-- Total Productos -->
          <article class="metric-card card-highlight" aria-labelledby="total-productos">
            <div class="card-header">
              <div class="icon-wrapper icon-highlight">
                <i class="fa-solid fa-tags"></i>
              </div>
              <span class="card-label">Productos registrados</span>
            </div>
            <div class="card-body">
              <h3 id="total-productos" class="metric-value">{{ totalProductos() }}</h3>
              <p class="metric-description">Total de productos en catálogo</p>
            </div>
            <div class="card-footer">
              <button class="btn-link" aria-label="Ver catálogo completo">
                Ver catálogo completo
                <i class="fa-solid fa-arrow-right"></i>
              </button>
            </div>
          </article>
          
        </div>
      </section>
      
    </div>
  }
</div>